"use strict";var e=require("react"),t=require("uuid"),n=require("invariant"),i=require("classnames");function r(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var a=r(e);function o(e,t){var n=e.x,i=e.y;return n>t.x&&n<t.x+t.width&&i>t.y&&i<t.y+t.height}function u(e,t){return e*t*t*(t>0?-1:1)}var l=function(){function e(e){this.id=e.id,this.position=e.position,this.velocity=e.velocity,this.rotation=e.rotation,this.dragCoefficient=e.dragCoefficient,this.width=e.width,this.height=e.height,this.opacity=e.opacity,this.spriteX=e.spriteX,this.spriteY=e.spriteY,this.spriteWidth=e.spriteWidth,this.spriteHeight=e.spriteHeight,this._lastUpdatedAt=Date.now()}return e.prototype.getNewForces=function(e,t){var n=e.wind*t,i=-e.gravity*t;return{x:n+u(this.dragCoefficient.x,this.velocity.x),y:i+u(this.dragCoefficient.y,this.velocity.y)}},e.prototype.update=function(e){var t=Date.now(),n=(t-this._lastUpdatedAt)/100;this.rotation.update(n),this.dragCoefficient.update(n);var i=this.getNewForces(e,n),r=i.x,a=i.y;this.velocity.update(n),this.velocity.x+=r,this.velocity.y+=a,this.position.update(n),this.position.x+=this.velocity.x*n,this.position.y+=this.velocity.y*n,this.width.update(n),this.height.update(n),this.opacity.update(n),this._lastUpdatedAt=t},e.prototype.previewPositionUpdate=function(e,t){var n=t/100,i=this.velocity.previewUpdate(n),r=this.getNewForces(e,n),a=r.x,o=r.y;i.x+=a,i.y+=o;var u=this.position.previewUpdate(n);return u.x+=i.x*n,u.y+=i.y*n,u},e.prototype.draw=function(e,t){t.save(),t.globalAlpha=this.opacity.value,t.setTransform((new DOMMatrix).translateSelf(this.position.x*global.devicePixelRatio,this.position.y*global.devicePixelRatio).rotateSelf(this.rotation.x,this.rotation.y,this.rotation.z)),t.drawImage(e,this.spriteX,this.spriteY,this.spriteWidth,this.spriteHeight,-this.width.value/2*global.devicePixelRatio,-this.height.value/2*global.devicePixelRatio,this.width.value*global.devicePixelRatio,this.height.value*global.devicePixelRatio),t.restore()},e.prototype.shouldDestroy=function(e,t){return this.opacity.value<0||t.gravity>=0&&this.velocity.y<0&&this.position.y+this.height.value<0||t.gravity<=0&&this.velocity.y>0&&this.position.y-this.height.value>e.height||t.wind>=0&&this.velocity.x>0&&this.position.x-this.width.value>e.width||t.wind<=0&&this.velocity.x<0&&this.position.x+this.width.value<0},e.prototype.addForce=function(e){this.velocity.x+=e.x,this.velocity.y+=e.y},e}(),s={velocity:{type:"static",value:{x:0,y:0}},rotation:{type:"static",value:{x:0,y:0,z:0}},dragCoefficient:{type:"static",value:{x:.001,y:.001}},opacity:{type:"static",value:1}},c=function(e){var t=void 0===e?{}:e,n=t.gravity,i=t.wind;this.gravity=-9.8,this.wind=0,this.gravity=null!=n?n:this.gravity,this.wind=null!=i?i:this.wind},d=function(e,t){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},d(e,t)};function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var f=function(){return f=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},f.apply(this,arguments)};var h=function(e){this.value=e},v=function(){function e(e,t){this._x=e,this._y=t}return e.prototype.update=function(e){this._x.update(e),this._y.update(e)},e.prototype.previewUpdate=function(e){return{x:this._x.previewUpdate(e),y:this._y.previewUpdate(e)}},Object.defineProperty(e.prototype,"x",{get:function(){return this._x.value},set:function(e){this._x.value=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y.value},set:function(e){this._y.value=e},enumerable:!1,configurable:!0}),e}(),m=function(e){function t(t,n,i){var r=e.call(this,t,n)||this;return r._z=i,r}return p(t,e),t.prototype.update=function(t){e.prototype.update.call(this,t),this._z.update(t)},t.prototype.previewUpdate=function(t){var n=e.prototype.previewUpdate.call(this,t);return f(f({},n),{z:this._z.previewUpdate(t)})},Object.defineProperty(t.prototype,"z",{get:function(){return this._z.value},set:function(e){this._z.value=e},enumerable:!1,configurable:!0}),t}(v),y=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return p(t,e),t.prototype.update=function(){},t.prototype.previewUpdate=function(){return this.value},t}(h),x=function(e){function t(t,n){var i=e.call(this,t)||this;return i.addValue=n,i}return p(t,e),t.prototype.update=function(e){this.value=this.previewUpdate(e)},t.prototype.previewUpdate=function(e){return this.value+this.addValue*e},t}(h),w=function(e){function t(t,n,i,r,a,o){var u=e.call(this,t)||this;u.min=n,u.max=i,u.duration=r;var l=u.value/(u.max-u.min)*u.duration,s=isNaN(l)?0:l;return u.timePassed=s<0?u.duration-s:s,u.directionMultiplier=a,u.easingFunction=o,u}return p(t,e),t.prototype.update=function(e){var t=this.doUpdate(e),n=t[0],i=t[1],r=t[2];this.value=n,this.directionMultiplier=r,this.timePassed=i},t.prototype.previewUpdate=function(e){return this.doUpdate(e)[0]},t.prototype.doUpdate=function(e){var t=this.max-this.min,n=this.timePassed+e*this.directionMultiplier,i=Math.min(Math.max(n,0),this.duration),r=n<0||n>this.duration?-1*this.directionMultiplier:this.directionMultiplier,a=this.easingFunction(i,this.min,t,this.duration);return[isNaN(a)?0:a,i,r]},t}(h);function g(e,t){return e===t?e:Math.random()*(t-e+1)+e}function C(e){var t=Math.floor(g(0,e.length-1));return[e[t],t]}function b(e,t){return C([e,t])[0]}function V(e){return function(e){switch(e.type){case"static":return new y(e.value);case"static-random":return new y(g(e.minValue,e.maxValue));case"linear":return new x(e.value,e.addValue);case"linear-random":return new x(g(e.minValue,e.maxValue),g(e.minAddValue,e.maxAddValue));case"oscillating":return new w(e.value,e.start,e.final,e.duration,e.direction,e.easingFunction);case"oscillating-random":return new w(g(e.minValue,e.maxValue),g(e.minStart,e.maxStart),g(e.minFinal,e.maxFinal),g(e.minDuration,e.maxDuration),b(e.minDirection,e.maxDirection),C(e.easingFunctions)[0])}}(f(f({},e),{valueType:"number"}))}function z(e){return function(e){switch(e.type){case"static":return new v(new y(e.value.x),new y(e.value.y));case"static-random":return new v(new y(g(e.minValue.x,e.maxValue.x)),new y(g(e.minValue.y,e.maxValue.y)));case"linear":return new v(new x(e.value.x,e.addValue.x),new x(e.value.y,e.addValue.y));case"linear-random":return new v(new x(g(e.minValue.x,e.maxValue.x),g(e.minAddValue.x,e.maxAddValue.x)),new x(g(e.minValue.y,e.maxValue.y),g(e.minAddValue.x,e.maxAddValue.x)));case"oscillating":return new v(new w(e.value.x,e.start.x,e.final.x,e.duration.x,e.direction.x,e.easingFunction),new w(e.value.y,e.start.y,e.final.y,e.duration.x,e.direction.y,e.easingFunction));case"oscillating-random":return new v(new w(g(e.minValue.x,e.maxValue.x),g(e.minStart.x,e.maxStart.x),g(e.minFinal.x,e.maxFinal.x),g(e.minDuration.x,e.maxDuration.x),b(e.minDirection.x,e.maxDirection.x),C(e.easingFunctions)[0]),new w(g(e.minValue.y,e.maxValue.y),g(e.minStart.y,e.maxStart.y),g(e.minFinal.y,e.maxFinal.y),g(e.minDuration.y,e.maxDuration.y),b(e.minDirection.y,e.maxDirection.y),C(e.easingFunctions)[0]))}}(f(f({},e),{valueType:"Vector2"}))}function D(e){return function(e){switch(e.type){case"static":return new m(new y(e.value.x),new y(e.value.y),new y(e.value.z));case"static-random":return new m(new y(g(e.minValue.x,e.maxValue.x)),new y(g(e.minValue.y,e.maxValue.y)),new y(g(e.minValue.z,e.maxValue.z)));case"linear":return new m(new x(e.value.x,e.addValue.x),new x(e.value.y,e.addValue.y),new x(e.value.z,e.addValue.z));case"linear-random":return new m(new x(g(e.minValue.x,e.maxValue.x),g(e.minAddValue.x,e.maxAddValue.x)),new x(g(e.minValue.y,e.maxValue.y),g(e.minAddValue.y,e.maxAddValue.y)),new x(g(e.minValue.z,e.maxValue.z),g(e.minAddValue.z,e.maxAddValue.z)));case"oscillating":return new m(new w(e.value.x,e.start.x,e.final.x,e.duration.x,e.direction.x,e.easingFunction),new w(e.value.y,e.start.y,e.final.y,e.duration.z,e.direction.y,e.easingFunction),new w(e.value.z,e.start.z,e.final.z,e.duration.z,e.direction.z,e.easingFunction));case"oscillating-random":return new m(new w(g(e.minValue.x,e.maxValue.x),g(e.minStart.x,e.maxStart.x),g(e.minFinal.x,e.maxFinal.x),g(e.minDuration.x,e.maxDuration.x),b(e.minDirection.x,e.maxDirection.x),C(e.easingFunctions)[0]),new w(g(e.minValue.y,e.maxValue.y),g(e.minStart.y,e.maxStart.y),g(e.minFinal.y,e.maxFinal.y),g(e.minDuration.y,e.maxDuration.y),b(e.minDirection.y,e.maxDirection.y),C(e.easingFunctions)[0]),new w(g(e.minValue.z,e.maxValue.z),g(e.minStart.z,e.maxStart.z),g(e.minFinal.z,e.maxFinal.z),g(e.minDuration.z,e.maxDuration.z),b(e.minDirection.z,e.maxDirection.z),C(e.easingFunctions)[0]))}}(f(f({},e),{valueType:"Vector3"}))}function F(e,t,i,r,a){var o=function(e){return f(f({},s),e)}(t),u=null!=o.size?V(o.size):null,c=null!=o.width?V(o.width):u,d=null!=o.height?V(o.height):u;n(null!=c,"width or size is required"),n(null!=d,"height or size is required");var p=function(e,t){if(null!=e){var n=t.sprites.findIndex((function(t){return n=t,"string"==typeof(i=e)?n.src===i&&n.colorize:n.src===i.src&&n.colorize===i.colorize;var n,i}));if(-1!==n)return[e,n]}return C(t.sprites)}(r,i),h=p[0],v=p[1],m=function(e,t,n){if(!function(e){return"string"==typeof e||e.colorize}(e))return 0;var i=null!=t?n.colors.findIndex((function(e){return e===t})):-1;return-1!==i?i:Math.floor(g(0,n.colors.length-1))}(null!=r?r:h,a,i);return new l({id:e,position:z(o.position),velocity:z(o.velocity),rotation:D(o.rotation),dragCoefficient:z(o.dragCoefficient),width:c,height:d,opacity:V(o.opacity),spriteX:m*i.spriteWidth+2*m,spriteY:v*i.spriteHeight+2*v,spriteWidth:i.spriteWidth,spriteHeight:i.spriteHeight})}var _=a.forwardRef((function(e,n){var i=e.className,r=e.environment,u=e.onClick,l=e.onMouseDown,s=e.onMouseMove,c=e.onMouseUp,d=e.onBeforeRender,p=e.onAfterRender,h=function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(e,["className","environment","onClick","onMouseDown","onMouseMove","onMouseUp","onBeforeRender","onAfterRender"]),v=a.useRef(null),m=a.useRef(new Map),y=a.useRef(null),x=a.useRef(0),w=a.useRef(0),g=a.useCallback((function(){var e=v.current;if(null!=e){var t=e.getContext("2d");if(null!=t){t.clearRect(0,0,e.width,e.height),null==d||d(t),m.current.forEach((function(n,i){var a=n.confetti,o=n.spriteCanvas;a.update(r),a.draw(o,t),a.shouldDestroy(e,r)&&m.current.delete(i)})),null==p||p(t),m.current.size>0?y.current=window.requestAnimationFrame(g):(t.clearRect(0,0,e.width,e.height),y.current=null);var n=Date.now();0!==x.current&&(w.current=1e3/(n-x.current)),x.current=n}}}),[r,p,d]);a.useEffect((function(){null!=y.current&&(window.cancelAnimationFrame(y.current),y.current=window.requestAnimationFrame(g))}),[g]);var C=a.useCallback((function(e,t){m.current.set(e.id,{confetti:e,spriteCanvas:t}),null==y.current&&g()}),[g]),b=a.useCallback((function(e,n,i,r,a){var o,u=F(null!==(o=e.id)&&void 0!==o?o:t.v4(),e,i,r,a);return C(u,n),u}),[C]),V=a.useCallback((function(e){m.current.delete(e)}),[]),z=a.useCallback((function(){return m.current.clear()}),[]),D=a.useCallback((function(){return v.current}),[]);a.useImperativeHandle(n,(function(){return{createConfetti:b,addConfetti:C,deleteConfetti:V,clearConfetti:z,getCanvas:D}}),[b,C,V,z,D]);var _=a.useCallback((function(e,t){var n,i,a=t.clickHandler,u=t.mouseHandler;if(null!=a||null!=u){var l=null===(n=v.current)||void 0===n?void 0:n.getBoundingClientRect();if(null!=l){var s=function(e,t){if(null==t)throw new Error("element should not be null");var n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}}(e,v.current);if(o(s,{x:l.left,y:l.top,width:l.width,height:l.height})){if(null!=u)return u(e);if(null!=a){var c=-1e3/w.current*2,d=function(e,t){for(var n=0,i=Array.from(e.values());n<i.length;n++){var r=i[n];if(null!=r&&t(r))return r}return null}(m.current,(function(e){var t=e.confetti,n=t.previewPositionUpdate(r,c);return o(s,{x:n.x-t.width.value/2,y:n.y-t.height.value/2,width:t.width.value,height:t.height.value})}));a(e,null!==(i=null==d?void 0:d.confetti)&&void 0!==i?i:null)}}}}}),[r]),O=a.useCallback((function(e){return _(e,{clickHandler:u})}),[_,u]),R=a.useCallback((function(e){return _(e,{clickHandler:l})}),[_,l]),U=a.useCallback((function(e){return _(e,{mouseHandler:s})}),[_,s]),P=a.useCallback((function(e){return _(e,{mouseHandler:c})}),[_,c]);return a.useEffect((function(){var e=function(e,t,n){null!=n&&window.addEventListener(e,t)};return e("click",O,u),e("mousedown",R,l),e("mousemove",U,s),e("mouseup",P,c),function(){window.removeEventListener("click",O),window.removeEventListener("mousedown",R),window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",U)}}),[O,R,U,P,u,l,s,c]),a.useEffect((function(){var e=v.current,t=new ResizeObserver((function(){!function(e){if(null!=e){var t=e.getBoundingClientRect(),n=t.width,i=t.height;e.width=n*global.devicePixelRatio,e.height=i*global.devicePixelRatio}}(v.current)}));return null!=e&&t.observe(e),function(){null!=e&&t.unobserve(e)}}),[]),a.createElement("canvas",f({},h,{className:i,ref:v}))}));var O="SpriteCanvas-module_spriteCanvasHidden__ndzQV";!function(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&i.firstChild?i.insertBefore(r,i.firstChild):i.appendChild(r),r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e))}}(".SpriteCanvas-module_spriteCanvasHidden__ndzQV {\n  display: none;\n  position: absolute;\n  width: 0;\n  height: 0;\n  left: -100%;\n}\n");var R=a.forwardRef((function(e,t){var n,r=e.className,o=e.visible,u=void 0!==o&&o,l=e.sprites,s=e.colors,c=e.spriteWidth,d=e.spriteHeight,p=a.useRef(null),f=a.useRef([]);a.useImperativeHandle(t,(function(){return{getCanvas:function(){return p.current},getCreateData:function(){return{sprites:f.current,colors:s,spriteWidth:c,spriteHeight:d}}}}),[s,d,c]);var h=a.useCallback((function(){var e=p.current,t=null==e?void 0:e.getContext("2d",{willReadFrequently:!0});null!=t&&null!=e&&(t.clearRect(0,0,e.width,e.height),f.current.forEach((function(e,n){var i=function(i,r){var a=c*r+2*r,o=d*n+2*n;if(t.drawImage(e.image,a,o,c,d),null!=i){for(var u=t.getImageData(a,o,c,d),l=function(e){"#"===e[0]&&(e=e.slice(1));var t=parseInt(e,16);return{r:t>>16&255,g:t>>8&255,b:255&t}}(i),s=0;s<u.data.length;s+=4)u.data[s]=l.r,u.data[s+1]=l.g,u.data[s+2]=l.b;t.putImageData(u,a,o)}};e.colorize?s.forEach((function(e,t){return i(e,t)})):i(null,0)})))}),[s,d,c]),v=a.useCallback((function(){var e=l.map((function(e){var t=new Image,n="string"==typeof e?e:e.src,i="string"==typeof e||e.colorize;t.src=n;var r=new Promise((function(e){t.onload=e}));return{colorize:i,image:t,src:n,loadPromise:r}}));Promise.all(e.map((function(e){return e.loadPromise}))).then((function(){f.current=e.map((function(e){return{colorize:e.colorize,image:e.image,src:e.src}})),h()}))}),[h,l]);return a.useEffect((function(){v()}),[v]),a.useEffect((function(){null!=p.current&&(p.current.width=(c+2)*Math.max(s.length,1),p.current.height=(d+2)*l.length)}),[s.length,d,c,l.length]),a.createElement("canvas",{ref:p,className:i(r,(n={},n[O]=!u,n))})}));exports.CREATE_CONFETTI_DEFAULTS=s,exports.Confetti=l,exports.ConfettiCanvas=_,exports.Environment=c,exports.LinearUpdatableValue=x,exports.OscillatingUpdatableValue=w,exports.SpriteCanvas=R,exports.StaticUpdatableValue=y,exports.createConfetti=F,exports.easeInOutQuad=function(e,t,n,i){return(e/=i/2)<1?n/2*e*e+t:-n/2*(--e*(e-2)-1)+t},exports.getUpdatableValueNumber=V,exports.getUpdatableValueVector2=z,exports.getUpdatableValueVector3=D,exports.useConfettiCannon=function(e,t){var n=a.useCallback((function(n,i){var r,a,o,u=void 0===i?{}:i,l=u.sprite,s=u.color,c=null===(r=t.current)||void 0===r?void 0:r.getCreateData(),d=null===(a=t.current)||void 0===a?void 0:a.getCanvas();if(null!=d&&null!=c&&0!==c.sprites.length)return null===(o=e.current)||void 0===o?void 0:o.createConfetti(n,d,c,l,s)}),[e,t]),i=a.useCallback((function(e,t,i){for(var r=[],a=0;a<t;a++){var o=n(e,i);o&&r.push(o)}return r}),[n]),r=a.useCallback((function(n){var i,r,a=null===(i=t.current)||void 0===i?void 0:i.getCanvas();null!=a&&(null===(r=e.current)||void 0===r||r.addConfetti(n,a))}),[e,t]),o=a.useCallback((function(t){var n;null===(n=e.current)||void 0===n||n.deleteConfetti(t)}),[e]),u=a.useCallback((function(){var t;return null===(t=e.current)||void 0===t?void 0:t.clearConfetti()}),[e]);return{createConfetti:n,createMultipleConfetti:i,addConfetti:r,clearConfetti:u,deleteConfetti:o}};
//# sourceMappingURL=index.js.map
